<?php
/**
 * @var \Bydn\VirtualMirror\Block\VirtualMirror $block
 */
?>
<?php if ($block->isVisible()) : ?>

    <div id="virtual-mirror-anchor" class="bydn-virtual-mirror">
        <button type="button" id="call-mirror-method" class="action secondary tocart">
            <span>Try on me</span>
        </button>
    </div>

    <!-- Pre-created modal -->
    <div id="virtual-mirror-modal" style="display: none;">
        <div class="virtual-mirror-content">
            <div class="loading-message">
                <?= __('Generating your virtual mirror image... Please wait, this can take up to 10 seconds...') ?>
            </div>
            <div class="error-message" style="display: none;">
                <?= __('Sorry, there was an error generating your image. Please try again.') ?>
            </div>
            <div class="virtual-mirror-image-container"></div>
        </div>
    </div>
    <script type="text/x-magento-init">
        {
            "#virtual-mirror-anchor": {
                "virtualMirrorProductAlert": {
                    "buttonSelector": "#call-mirror-method",
                    "generateImageEndpoint": "<?php echo $block->getImageGenerationEndpoint(); ?>",
                    "productId": "<?php echo $block->getProductId(); ?>"
                }
            }
        }
    </script>
    <style>
        /* Virtual Mirror Modal Styles */
        .virtual-mirror-modal {
            left: auto;
            right: 0;
            max-width: 800px;
            display: flex !important;
            justify-content: center;
            align-items: center;
        }
        
        .virtual-mirror-modal .modal-inner-wrap {
            max-width: 800px;
            position: relative;
            margin: 0;
            transform: none;
        }
        
        .virtual-mirror-modal .modal-content {
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .virtual-mirror-modal .modal-header {
            padding: 2.4rem 2.4rem 0;
        }

        .virtual-mirror-modal .loading-message,
        .virtual-mirror-modal .error-message {
            text-align: center;
            padding: 20px;
            font-size: 16px;
        }

        .virtual-mirror-modal .error-message {
            color: #e02b27;
        }

        .virtual-mirror-modal .virtual-mirror-image-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }
        
        .virtual-mirror-modal .modal-footer {
            padding: 2.4rem;
            text-align: right;
        }
        
        .virtual-mirror-modal img {
            display: block;
            max-width: 100%;
            height: auto;
        }
    </style>
    
<?php endif; ?>